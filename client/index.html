<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>ACESE ‚Äì IEPP GRABO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--orange:#ff6f00;--vert:#2e7d32;--blanc:#fff;--gris:#f5f5f5;--bleu:#002d72}
    body{font-family:'Arial', sans-serif;margin:0;background:var(--gris);color:#333}
    .header-top{width:100%;background:var(--bleu);color:var(--blanc);padding:10px 20px;display:flex;justify-content:space-between;align-items:center;font-size:0.85rem;line-height:1.3}
    .header-top .left{text-align:left}.header-top .right{text-align:right}.header-top .line{border-top:1px solid var(--blanc);margin-top:2px}
    .header-main{width:100%;background:linear-gradient(135deg, var(--orange) 0%, var(--vert) 100%);color:var(--blanc);padding:20px;display:flex;justify-content:space-between;align-items:center;font-size:1.2rem;text-shadow:1px 1px 3px rgba(0,0,0,.3)}
    .header-main .left{text-align:left}.header-main .right{text-align:right}.header-main .line{border-top:1px solid var(--blanc);margin-top:3px}
    .logo{height:60px;margin-left:10px}
    section{background:var(--blanc);border:3px solid var(--orange);border-radius:20px;padding:20px;margin:20px;box-shadow:0 6px 12px rgba(0,0,0,.1)}
    label{display:block;margin:8px 0;font-weight:bold;color:var(--vert)}
    input,select{width:100%;padding:10px;border:2px solid var(--orange);border-radius:12px;background:var(--blanc);font-size:14px}
    input:focus,select:focus{outline:none;border-color:#66bb6a;box-shadow:0 0 5px #66bb6a}
    button{background:var(--orange);color:var(--blanc);border:none;padding:10px 16px;border-radius:12px;font-size:14px;font-weight:bold;cursor:pointer;transition:transform .2s,background .3s}
    button:hover{background:#e65100;transform:scale(1.05)}
    .del{background:#e74c3c;color:#fff;border:none;padding:4px 8px;border-radius:8px;cursor:pointer}
    table{width:100%;border-collapse:collapse;font-size:12px;background:var(--blanc);border-radius:12px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1)}th,td{border:1px solid var(--orange);padding:4px;text-align:center}th{background:#66bb6a;color:var(--blanc)}.hide{display:none}
  </style>
</head>
<body>
<!-- ===== EN-T√äTE OFFICIEL ===== -->
<header style="width:100%;background:#002d72;color:#fff;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;font-size:0.85rem;line-height:1.3">
  <!-- GAUCHE : mentions + logo -->
  <div style="text-align:left">
    <div>MINIST√àRE DE L'√âDUCATION NATIONALE</div>
    <div style="border-top:1px solid #fff;margin-top:2px">ET DE L'ALPHABETISATION</div>
    <div style="border-top:1px solid #fff;margin-top:2px">DRENA DE SAN-PEDRO</div>
    <div style="border-top:1px solid #fff;margin-top:2px">IEPP DE GRABO</div>
    <img src="./logo.png" alt="Logo IEPP GRABO" style="height:100px;margin-top:40px">
  </div>
  <!-- DROITE : R√©publique -->
  <div style="text-align:right">
    <div>R√âPUBLIQUE DE C√îTE D'IVOIRE</div>
    <div style="border-top:1px solid #fff;margin-top:2px">Union - Discipline - Travail</div>
  </div>
</header>
<section id="screen-setup">
  <center><h1>üçä ACESE - IEPP GRABO üçè</h1></center>
  <p><em><center>Appli de Collecte des √âl√®ves Sans Extraits</center></em></p>
  <form id="formSetup">
    <label>DRENA
      <select name="drena" required>
        <option value="">-- Choisissez --</option>
        <option>DRENA SAN-PEDRO</option>
      </select>
    </label>
    <label>IEPP
      <select name="iepp" required>
        <option value="">-- Choisissez --</option>
        <option>IEPP GRABO</option>
      </select>
    </label>
    <label>Secteur p√©dagogique
      <select name="secteur_pedagogique" required>
        <option value="">-- Choisissez --</option>
        <option>SECTEUR GNATO</option>
        <option>SECTEUR GRABO-EST</option>
        <option>SECTEUR GRABO-EST 2</option>
        <option>SECTEUR GRABO-OUEST</option>
        <option>SECTEUR GRABO-OUEST 2</option>
      </select>
    </label>
    <label>√âcole
      <select name="nom_ecole" id="selectEcole" required>
        <option value="">-- Choisissez votre √©cole--</option>
    </select>
    </label>
    <label>Nom du directeur
      <input type="text" name="nom_directeur" required>
    </label>
    <label>Pr√©noms du directeur
      <input type="text" name="prenoms_directeur" required>
    </label>
    <label>Contact t√©l√©phonique 1
      <input type="tel" name="contact1" pattern="[0-9]{10}" maxlength="10" required>
    </label>
    <label>Contact t√©l√©phonique 2 (facultatif)
      <input type="tel" name="contact2" pattern="[0-9]{10}" maxlength="10">
    </label>
    <label>Email (facultatif)
      <input type="email" name="email">
    </label>
    <button type="submit">Enregistrer & continuer</button>
     </form>
  <script>
  const secteurSelect = document.querySelector('[name="secteur_pedagogique"]');
  const ecoleSelect = document.getElementById('selectEcole');
const ecolesParSecteur = {
  'SECTEUR GNATO': [
    'EPP DE DEOHAKO',
    'EPP 1 DE GBAPET VILLAGE',
    'EPP 2 DE GBAPET VILLAGE',
    'EPP 1 DE GNATO',
    'EPP 2 DE GNATO',
    'EPP UNICEF DE GNATO'
  ],
  'SECTEUR GRABO-EST': [
    'EPP 1A DE GRABO',
    'EPP 1B DE GRABO',
    'EPP 3 DE GRABO',
    'EPP UAI DE GBAPET'
  ],
  'SECTEUR GRABO-EST 2': [
    'EPP DE ALLOUKRO',
    'EPP DE BOHOUSSOUKRO',
    'EPP DE DIOULABOUGOU',
    'EPP UNICEF DE BINKADI',
    'EPP DE WATINOMA',
    'EPP DE YASSOUAKRO'
  ],
  'SECTEUR GRABO-OUEST': [
    'EPP ALASSANE OUATTARA DE GRABO',
    'EPP DE F√ãTAI',
    'EPP JULES HIE NEA DE GRABO',
    'EPP DE PODOUE',
    'EPP DE SOTO'
  ],
  'SECTEUR GRABO-OUEST 2': [
    'EPP DE ABRAHAMDIHOKE',
    'EPP 1 DE DEBLABLAI',
    'EPP 2 DE DEBLABLAI',
    'EPP DE NEGBATCHI',
    'EPP DE SIAHE'
  ]
};  
  function remplirEcoles() {
    const secteur = secteurSelect.value;
    ecoleSelect.innerHTML = '<option value="">-- Choisissez votre √©cole --</option>';
    if (secteur && ecolesParSecteur[secteur]) {
      ecolesParSecteur[secteur].forEach(ecole => {
        const opt = document.createElement('option');
        opt.value = ecole;
        opt.textContent = ecole;
        ecoleSelect.appendChild(opt);
      });
    }
  }

  // au chargement + au changement
  remplirEcoles();
  secteurSelect.addEventListener('change', remplirEcoles);
</script>
</section>
<section id="screen-app" class="hide">
  <center> <h1>üçä Saisie des √©l√®ves üçè</h1></center>
  <button id="btnRetour" onclick="retourParametrage()">‚Ü© Retour au param√©trage</button>

  <form id="formEleve">
    <label>Nom
      <input type="text" name="nom" required>
    </label>
    <label>Pr√©noms
      <input type="text" name="prenoms" required>
    </label>
    <label>Sexe
      <select name="sexe" required>
        <option value="G">G</option>
        <option value="F">F</option>
      </select>
    </label>
    <label>Date de naissance probable (jj/mm/aaaa)</label>
    <div style="display:flex;gap:4px">
      <input type="number" id="dn_j" placeholder="jj" min="1" max="31" required style="flex:1">
      <input type="number" id="dn_m" placeholder="mm" min="1" max="12" required style="flex:1">
      <input type="number" id="dn_a" placeholder="aaaa" min="2010" max="2023" required style="flex:2">
    </div>
    <label>Classe
      <select name="classe" required>
        <option value="">-- Choisissez --</option>
        <option>CP1</option>
        <option>CP2</option>
        <option>CE1</option>
        <option>CE2</option>
        <option>CM1</option>
        <option>CM2</option>></select></label>
    <label>Nom complet du p√®re<input type="text" name="nom_pere" required></label>
    <label>N¬∞ du p√®re<input type="tel" name="numero_pere" pattern="[0-9]{10}" maxlength="10" required></label>
    <label>Nationalit√© du p√®re<input type="text" name="nationalite_pere" value="Ivoirienne" required></label>
    <label>Nom complet de la m√®re<input type="text" name="nom_mere" required></label>
    <label>N¬∞ de la m√®re<input type="tel" name="numero_mere" pattern="[0-9]{10}" maxlength="10" required></label>
    <label>Nationalit√© de la m√®re<input type="text" name="nationalite_mere" value="Ivoirienne" required></label>
    <label>Nom complet du t√©moin<input type="text" name="nom_temoin" required></label>
    <label>N¬∞ du t√©moin<input type="tel" name="numero_temoin" pattern="[0-9]{10}" maxlength="10" required></label>
    <button type="submit">Ajouter √©l√®ve</button>
  </form>
  <h2>Liste locale (<span id="nb">0</span>)</h2>
  <table id="tableEleves"><thead><tr><th>Modif</th><th>Nom</th><th>Pr√©noms</th><th>Sexe</th><th>Date naiss.</th><th>Classe</th><th>Suppr</th></tr></thead><tbody></tbody></table>
  <center><button onclick="upload()">ENVOYER SUR LE SERVEUR DE L'IEPP</button>
  <center><button onclick="exportCSV()">CSV</button>
</section>
<script>
  const SERVER_URL = 'https://acesegrabo-h2jn.onrender.com/api/eleves';
  let CONFIG = JSON.parse(localStorage.getItem('config') || 'null');
  let ELEVES = JSON.parse(localStorage.getItem('eleves') || '[]');
  let EDIT_INDEX = null;
  window.onload = () => {
    if (CONFIG) {
      document.getElementById('screen-setup').classList.add('hide');
      document.getElementById('screen-app').classList.remove('hide');
      refreshTable();
    }
  };
  ddocument.getElementById('formSetup').addEventListener('submit', e => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  localStorage.setItem('config', JSON.stringify(data));
  CONFIG = data;
  // petit d√©lai pour Safari
  setTimeout(() => {
    document.getElementById('screen-setup').classList.add('hide');
    document.getElementById('screen-app').classList.remove('hide');
  }, 100);
});
 
  // retire la pop-up
function retourParametrage() {
  // message doux
  const msg = document.createElement('div');
  msg.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#002d72;color:#fff;padding:10px 20px;border-radius:8px;z-index:9999;font-size:0.9rem;';
  msg.textContent = 'Retour au param√©trage en cours...';
  document.body.appendChild(msg);
  setTimeout(() => {
    document.body.removeChild(msg);
    document.getElementById('screen-app').classList.add('hide');
    document.getElementById('screen-setup').classList.remove('hide');
  }, 800);
}
  document.getElementById('formEleve').addEventListener('submit', e => {
    e.preventDefault();
    const j = String(document.getElementById('dn_j').value).padStart(2,'0');
    const m = String(document.getElementById('dn_m').value).padStart(2,'0');
    const a = document.getElementById('dn_a').value;
    if(!j||!m||!a){alert('Date incompl√®te');return;}
    const dateFr = `${j}/${m}/${a}`;
    const data = Array.from(e.target.querySelectorAll('input,select')).filter(el=>!el.id).reduce((a,el)=>(a[el.name]=el.value,a),{});
    data.date_naissance_probable = dateFr;
    const cle = (data.nom + data.prenoms + dateFr).toLowerCase();
    const existe = ELEVES.some((el, i) => i !== EDIT_INDEX && (el.nom + el.prenoms + el.date_naissance_probable).toLowerCase() === cle);
    if (existe) { alert('Cet √©l√®ve existe d√©j√† dans la liste !'); return; }
    if (EDIT_INDEX === null) {
      ELEVES.push(data);
    } else {
      ELEVES[EDIT_INDEX] = data;
      cancelEdit();
    }
    localStorage.setItem('eleves', JSON.stringify(ELEVES));
    e.target.reset();
    refreshTable();
  });
  function cancelEdit() {
    EDIT_INDEX = null;
    document.getElementById('formEleve').reset();
    document.querySelector('#formEleve button[type=submit]').textContent = 'Ajouter √©l√®ve';
    const btnCancel = document.querySelector('#btnCancel');
    if (btnCancel) btnCancel.remove();
  }
  function editEleve(idx) {
    EDIT_INDEX = idx;
    const el = ELEVES[idx];
    document.querySelector('[name=nom]').value = el.nom;
    document.querySelector('[name=prenoms]').value = el.prenoms;
    document.querySelector('[name=sexe]').value = el.sexe;
    const [jj,mm,aaaa] = el.date_naissance_probable.split('/');
    document.getElementById('dn_j').value = jj;
    document.getElementById('dn_m').value = mm;
    document.getElementById('dn_a').value = aaaa;
    document.querySelector('[name=classe]').value = el.classe;
    document.querySelector('[name=nom_pere]').value = el.nom_pere;
    document.querySelector('[name=numero_pere]').value = el.numero_pere;
    document.querySelector('[name=nationalite_pere]').value = el.nationalite_pere;
    document.querySelector('[name=nom_mere]').value = el.nom_mere;
    document.querySelector('[name=numero_mere]').value = el.numero_mere;
    document.querySelector('[name=nationalite_mere]').value = el.nationalite_mere;
    document.querySelector('[name=nom_temoin]').value = el.nom_temoin;
    document.querySelector('[name=numero_temoin]').value = el.numero_temoin;
    document.querySelector('#formEleve button[type=submit]').textContent = 'Enregistrer les modifications';
    if (!document.querySelector('#btnCancel')) {
      const cancel = document.createElement('button');
      cancel.type = 'button'; cancel.id = 'btnCancel'; cancel.textContent = 'Annuler';
      cancel.onclick = cancelEdit;
      document.querySelector('#formEleve button[type=submit]').after(cancel);
    }
  }
  function supprimerEleve(idx) {
    if (confirm('Voulez-vous vraiment supprimer cet √©l√®ve ?')) {
      ELEVES.splice(idx, 1);
      localStorage.setItem('eleves', JSON.stringify(ELEVES));
      refreshTable();
    }
  }
  function refreshTable() {
    const tbody = document.querySelector('#tableEleves tbody');
    tbody.innerHTML = '';
    ELEVES.forEach((e, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td><button onclick="editEleve(${idx})">‚úèÔ∏è</button></td><td>${e.nom}</td><td>${e.prenoms}</td><td>${e.sexe}</td><td>${e.date_naissance_probable}</td><td>${e.classe}</td><td><button class="del" onclick="supprimerEleve(${idx})">üóëÔ∏è</button></td>`;
      tbody.appendChild(tr);
    });
    document.getElementById('nb').textContent = ELEVES.length;
  }
  async function upload() {
    if (!ELEVES.length) return alert("Aucun √©l√®ve √† envoyer");
    const payload = { ...CONFIG, eleves: ELEVES };
    try {
      const r = await fetch(SERVER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (r.ok) {
        alert("Donn√©es envoy√©es avec succ√®s !");
        localStorage.removeItem('eleves');
        ELEVES = [];
        refreshTable();
      } else {
        alert("Erreur lors de l'envoi.");
      }
    } catch (e) {
      alert("Probl√®me de connexion.");
    }
  }
  function exportCSV() {
    let csv = 'Nom;Pr√©noms;Sexe;Date naissance;Classe;Nom p√®re;T√©l p√®re;Nationalit√© p√®re;Nom m√®re;T√©l m√®re;Nationalit√© m√®re;Nom t√©moin;T√©l t√©moin\n';
    ELEVES.forEach(e => {
      csv += `${e.nom};${e.prenoms};${e.sexe};${e.date_naissance_probable};${e.classe};${e.nom_pere};${e.numero_pere};${e.nationalite_pere};${e.nom_mere};${e.numero_mere};${e.nationalite_mere};${e.nom_temoin};${e.numero_temoin}\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'eleves.csv'; a.click();
  }
</script>
    <center>Applicatif Pr0puls√© par _DJ3K S3PH1R0TH_ - 2025
</body>
</html>
